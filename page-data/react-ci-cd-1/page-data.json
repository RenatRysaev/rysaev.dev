{"componentChunkName":"component---src-templates-blog-post-js","path":"/react-ci-cd-1/","webpackCompilationHash":"7210724119aa177d8df9","result":{"data":{"site":{"siteMetadata":{"title":"Блог о веб-разработке","author":"Ренат Рысаев"}},"markdownRemark":{"id":"c5ef6afc-9c5a-55ca-a17e-709b41993f85","excerpt":"Я планирую серию статей, в которых постараюсь раскрыть следующие темы: Docker для разработки React-приложения Docker для развертывания React-приложения + Nginx…","html":"<h2>Я планирую серию статей, в которых постараюсь раскрыть следующие темы:</h2>\n<ol>\n<li><a href=\"https://rysaev.dev/react-ci-cd-1/\"><b>Docker для разработки React-приложения</b></a></li>\n<li><a href=\"https://rysaev.dev/react-ci-cd-2/\"><b>Docker для развертывания React-приложения + Nginx для раздачи статики</b></a></li>\n<li><b>CI/CD с использованием Jenkins</b></li>\n</ol>\n<h3>Это первая часть, в которой мы разберемся с тем как настроить окружение для разработки с Docker + React</h3>\n<h3>Вступление</h3>\n<p>Все началось с того, что однажды на рабочем проекте потребовалось обновить зависимости.\nПосле долгих мучений я наконец-то запушил свой коммит в репозиторий и отправился к нашему девопсу,\nчтобы попросить задеплоить сборку из jenkins на тестовый сервер. Ну и как вы уже, наверное, догадываетесь девопсу этого сделать\nне удалось, потому что на сервере с jenkins стояла node.js другой версии и закешировались старые версии библиотек.\nЯ бы скорее всего решил эту проблему, но на следующий рабочий день меня переводили на другой проект.</p>\n<p>Ну собственно я к чему, используя docker, мы точно бы не имели этих проблем, и вот почему:</p>\n<ol>\n<li>Единое окружение локально и на сервере</li>\n<li>Воспроизводимость</li>\n</ol>\n<p>Поэтому я решил немного раскурить Docker и поделиться полезной информацией о том\nкак его использовать для разработки и деплоя.  </p>\n<blockquote>\n<p><a href=\"https://github.com/RenatRysaev/dockerized-react/tree/react-ci-cd-1\">Репозиторий с итоговым кодом</a> для этой статьи</p>\n</blockquote>\n<p><b>Предпологается что на вашей машине уже установлено:</b></p>\n<ol>\n<li><a href=\"https://www.docker.com/\">Docker</a> v18.09.2</li>\n<li><a href=\"https://github.com/facebook/create-react-app\">Create React App</a> v3.0.1</li>\n</ol>\n<h3>Создание проекта</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">create-react-app dockerized-react\n<span class=\"token function\">cd</span> dockerized-react</code></pre></div>\n<h3>Напишем наш Dockerfile для создания образа</h3>\n<p><b>Dockerfile</b></p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># Берем node.js v8 в качестве родительского образа</span>\n<span class=\"token keyword\">FROM</span> node<span class=\"token punctuation\">:</span>8\n<span class=\"token comment\"># Устанавливаем рабочую директорию</span>\n<span class=\"token keyword\">WORKDIR</span> /app\n<span class=\"token comment\"># Копируем файлы yarn.lock и package.json в рабочую директорию</span>\n<span class=\"token keyword\">COPY</span> package.json yarn.lock /app/\n<span class=\"token comment\"># Устанавливаем зависимости</span>\n<span class=\"token keyword\">RUN</span> yarn install\n<span class=\"token comment\"># Открываем порт 3000</span>\n<span class=\"token keyword\">EXPOSE</span> 3000\n<span class=\"token comment\"># Запускаем React-приложение после запуска контейнера</span>\n<span class=\"token keyword\">CMD</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"yarn\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"start\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<h3>Добавим в .dockerignore директории/файлы, которые не должны попасть в образ</h3>\n<p><b>.dockerignore</b></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.git\nnode_modules\nbuild</code></pre></div>\n<h3>Создание образа</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker build -t dockerized-app:dev <span class=\"token keyword\">.</span></code></pre></div>\n<h3>Запуск контейнера</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run -it -v <span class=\"token variable\">${PWD}</span>:/app -v /app/node_modules -p 3001:3000 -e CHOKIDAR_USEPOLLING<span class=\"token operator\">=</span>true dockerized-app:dev</code></pre></div>\n<p>Для Windows</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker run -it -v %cd%:/app -v /app/node_modules -p 3001:3000 -e CHOKIDAR_USEPOLLING<span class=\"token operator\">=</span>true dockerized-app</code></pre></div>\n<p><b>Давайте разберемся для чего и какие аргументы мы передаем</b></p>\n<ol>\n<li>“-it” - интерактивный режим</li>\n<li>“-v ${PWD}:/app” - монтируем текущую рабочую директорию в директорию /app docker-контейнера</li>\n<li>“-v /app/node<em>modules” - используем node</em>modules из контейнера</li>\n<li>“-p” - сопоставляем порт docker-контейнера порту на хост системе</li>\n<li>“-e CHOKIDAR_USEPOLLING=true” - устанавливаем переменную окружения для принудительного слежения webpack за нашим томом.</li>\n</ol>\n<p>Осталось открыть приложение в браузере <a href=\"http://localhost:3001/\">http://localhost:3001/</a></p>\n<p>Готово, теперь webpack отслеживает изменения файлов и изменив код в каком-либо файле мы сможем увидеть результат в браузере.</p>\n<p><b>В следующей статье мы будем разбираться с тем подготовить окружение для развертывания Docker + React</b></p>","frontmatter":{"title":"Используем Docker для разработки и развертывания React-приложений. Часть 1.","date":"July 21, 2019","description":"Готовим окружение для разработки React-приложения с Docker."}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/react-ci-cd-1/","previous":{"fields":{"slug":"/about-me/"},"frontmatter":{"title":"Знакомство"}},"next":{"fields":{"slug":"/react-ci-cd-2/"},"frontmatter":{"title":"Используем Docker для разработки и развертывания React-приложений. Часть 2."}}}}}